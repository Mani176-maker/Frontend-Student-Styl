<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Style - Print Service</title>
  <style>
    /* Reset some defaults */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
      font-size: 2rem;
    }

    form {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      width: 100%;
      max-width: 500px;
      animation: fadeIn 0.8s ease-in-out;
    }

    label {
      display: block;
      margin-bottom: 15px;
      color: #444;
      font-weight: 600;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input:focus, select:focus {
      border-color: #6a82fb;
      box-shadow: 0 0 6px rgba(106,130,251,0.5);
      outline: none;
    }

    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #6a82fb, #fc5c7d);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 10px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <form onsubmit="event.preventDefault(); pay();">
    <h1>Student Style Print Order</h1>

    <label>Name:
      <input type="text" id="name" required>
    </label>

    <label>Phone:
      <input type="text" id="phone" required>
    </label>

    <label>Pages:
      <input type="number" id="pages" oninput="calculateAmount()" required>
    </label>

    <label>Print Type:
      <select id="printType" onchange="calculateAmount()">
        <option value="bw">Black & White</option>
        <option value="color">Color</option>
      </select>
    </label>

    <label>Binding Type:
      <select id="bindingType" onchange="calculateAmount()">
        <option value="">None</option>
        <option value="spiral">Spiral</option>
      </select>
    </label>

    <label>Amount:
      <input type="text" id="amount" readonly>
    </label>

    <label>Files:
      <input type="file" id="files" multiple required>
    </label>

    <button type="submit">Pay & Submit</button>
  </form>

  <script>
    const BASE_URL = "https://student-style.onrender.com";
    let currentPrices = { bw: 1.5, color: 10, spiral: 20 }; // fallback defaults

    // Load prices from backend when page loads
    window.addEventListener("DOMContentLoaded", () => {
      fetch(`${BASE_URL}/admin/prices`, {
        headers:{ Authorization: "Bearer admin-token" } // demo only; replace with secure flow
      })
      .then(r => r.json())
      .then(p => currentPrices = p)
      .catch(() => console.log("Using default prices"));
    });

    // Calculate amount dynamically
    function calculateAmount(){
      let pages = parseInt(document.getElementById("pages").value || "0");
      let printType = document.getElementById("printType").value;
      let bindingType = document.getElementById("bindingType").value;

      let amount = 0;
      if(printType === "bw") amount += pages * currentPrices.bw;
      if(printType === "color") amount += pages * currentPrices.color;
      if(bindingType === "spiral") amount += currentPrices.spiral;

      document.getElementById("amount").value = amount.toFixed(2);
    }

    // Payment flow
    function pay(){
      const form = new FormData();
      [...files.files].forEach(f => form.append("files", f));

      form.append("service", "print");
      form.append("name", name.value);
      form.append("phone", phone.value);
      form.append("printType", printType.value);
      form.append("bindingType", bindingType.value);
      form.append("amount", amount.value);

      fetch(`${BASE_URL}/order`, {
        method:"POST",
        body:form
      })
      .then(r => r.json())
      .then(d => {
        const rzp = new Razorpay({
          key: d.key,
          amount: d.amount * 100,  // Razorpay expects paise
          currency: "INR",
          order_id: d.orderId,
          handler: () => alert("Payment successful! Order placed.")
        });
        rzp.open();
      });
    }
  </script>
</body>
</html>
