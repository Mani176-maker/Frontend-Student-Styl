<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Dashboard</title>

<style>
body{font-family:Arial;background:#f4f6fb;padding:20px}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
button{padding:6px 10px}
.pending{color:orange}
.done{color:green}
</style>
</head>

<body>

<h2>Admin Login</h2>
<div id="login">
  <input id="user" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="panel" style="display:none">
  <h2>Orders</h2>
  <div id="orders"></div>

  <h2>Manage Prices</h2>
  <div id="prices"></div>
  <br>
  <button onclick="updatePrices()">Save Prices</button>
</div>

<script>
let TOKEN="";
const BASE_URL = "https://student-style.onrender.com";

function login(){
  fetch(`${BASE_URL}/admin/login`, {
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({user:user.value, pass:pass.value})
  })
  .then(r=>r.json())
  .then(d=>{
    TOKEN=d.token;
    login.style.display="none";
    panel.style.display="block";
    loadOrders();
    loadPrices();
  });
}

function loadOrders(){
  fetch(`${BASE_URL}/admin/orders`, {
    headers:{ Authorization: `Bearer ${TOKEN}` }
  })
  .then(r=>r.json())
  .then(list=>{
    orders.innerHTML=list.map(o=>`
      <div class="card">
        <b>${o.name}</b> — ₹${o.amount}<br>
        ${o.printType} / ${o.bindingType}<br>
        Status: <span class="${o.status==='pending'?'pending':'done'}">${o.status}</span><br><br>
        ${o.files.map(f=>`
          <a href="${BASE_URL}/uploads/${f}" target="_blank">Download PDF</a>
        `).join("<br>")}
        <br><br>
        <button onclick="mark('${o.id}')">Mark Completed</button>
      </div>
    `).join("");
  });
}

function mark(id){
  fetch(`${BASE_URL}/admin/status`, {
    method:"POST",
    headers:{
      'Content-Type':'application/json',
      Authorization: `Bearer ${TOKEN}`
    },
    body:JSON.stringify({id, status:"completed"})
  }).then(loadOrders);
}

function loadPrices(){
  fetch(`${BASE_URL}/admin/prices`, {
    headers:{ Authorization: `Bearer ${TOKEN}` }
  })
  .then(r=>r.json())
  .then(p=>{
    prices.innerHTML = `
      <div class="card">
        <label>Black & White (per page): <input id="bw" value="${p.bw}"></label><br>
        <label>Color (per page): <input id="color" value="${p.color}"></label><br>
        <label>Spiral Binding: <input id="spiral" value="${p.spiral}"></label>
      </div>
    `;
  });
}

function updatePrices(){
  const newPrices = {
    bw: parseFloat(document.getElementById("bw").value),
    color: parseFloat(document.getElementById("color").value),
    spiral: parseFloat(document.getElementById("spiral").value)
  };

  fetch(`${BASE_URL}/admin/prices`, {
    method:"POST",
    headers:{
      'Content-Type':'application/json',
      Authorization: `Bearer ${TOKEN}`
    },
    body:JSON.stringify(newPrices)
  })
  .then(()=>alert("Prices updated successfully!"));
}
</script>

</body>
</html>
